
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Phrase Tag Viewer — Installation Guide</title>
  <style>
    :root { --bg:#0b1220; --panel:#0f1629; --text:#e6eefc; --muted:#9fb3d9; --accent:#7aa2ff; --ok:#2bd48f; }
    * { box-sizing:border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font:16px/1.55 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif; }
    .wrap { max-width:960px; margin:40px auto; padding:0 20px; }
    h1 { font-size:28px; margin:0 0 8px; }
    h2 { margin:28px 0 10px; font-size:20px; }
    p  { color:var(--muted); }
    .card { background:var(--panel); border:1px solid rgba(255,255,255,.07); border-radius:12px; padding:18px; margin:16px 0; }
    ol.steps { padding-left:20px; }
    .codewrap { position:relative; margin-top:12px; }
    .copybtn {
      position:absolute; top:10px; right:10px; padding:8px 12px; border-radius:8px;
      background:var(--accent); color:#06131f; border:none; font-weight:700; cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.25);
    }
    .copybtn:active { transform:translateY(1px); }
    pre { margin:0; max-height:420px; overflow:auto; background:#0a1020; border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:16px; }
    code { color:#c7d7ff; font-family:ui-monospace,Menlo,Consolas,Monaco,monospace; font-size:13px;
           white-space:pre-wrap; overflow-wrap:anywhere; word-break:break-word; }
    .tip { color:#b7c7ee; font-size:14px; }
    .ok { color:var(--ok); font-weight:700; }
    a.btn {
      display:inline-block; padding:10px 14px; border-radius:10px; text-decoration:none;
      background:#18233b; color:#dbe7ff; border:1px solid rgba(255,255,255,.08);
    }
    a.btn:hover { background:#1b2744; }
    ul { margin:0; padding-left:20px; }
    .notice { font-size:14px; color:#c8d6ff; opacity:.9; margin:8px 0 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Phrase Tag Viewer</h1>
    <p class="tip">
      A small helper that reads the <b>active target segment</b> in Phrase/Memsource and shows a
      copy-ready string where <b>Phrase tag widgets are replaced by their literal values</b>.
      It supports <code>mq:rxt</code> (via <code>displaytext</code>/<code>val</code>) and
      paired tags (<code>bpt/ept</code>, e.g. <code>&lt;strong&gt;</code>…<code>&lt;/strong&gt;</code>).
      Numbers inside braces like <code>{{123}}</code> are output as <code>123</code>.
    </p>

    <div class="card">
      <h2>1) Install Tampermonkey</h2>
      <p>Install the Tampermonkey extension for your browser:</p>
      <p><a class="btn" href="https://www.tampermonkey.net/" target="_blank" rel="noopener noreferrer">Go to tampermonkey.net</a></p>
      <p class="tip">On that page, pick your browser (Chrome, Edge, Firefox, etc.) and follow the store link to install.</p>
    </div>

    <div class="card">
      <h2>2) Create a new userscript</h2>
      <ol class="steps">
        <li>Click the Tampermonkey icon in your browser toolbar (you may need to enable it in your browser's extension settings).</li>
        <li>Click <b>+ Create a new script…</b>.</li>
      </ol>
    </div>

    <div class="card">
      <h2>3) Paste the script, then save</h2>
      <p>Copy the script below by clicking <b>Copy code</b>, then paste into the Tampermonkey editor, replacing any previous content. Save by going to <b>File → Save</b> or using <b>Ctrl+S</b>.</p>

      <div class="codewrap">
        <button class="copybtn" id="copyCodeBtn">Copy code</button>
        <pre><code id="codeblock">(no script pasted yet)</code></pre>
      </div>
      <!-- The payload below is NEVER executed and NEVER parsed as HTML/JS. It's plain text. -->
      <script id="payload" type="text/plain">
// ==UserScript==
// @name         Phrase Tag Viewer
// @namespace    hs.phrase.copyexport
// @version      1.0.3
// @description  Copy-ready export of active Phrase target segment: tag widgets → values (mq:rxt) and bpt/ept inner markup; strip {123}→123; colored tags by theme; light/dark w/ memory; iframe-safe; selection-safe.
// @match        https://app.phrase.com/*
// @match        https://*.phrase.com/*
// @match        https://cloud.memsource.com/*
// @match        https://*.memsource.com/*
// @exclude      https://cloud.memsource.com/web/project*
// @exclude      https://cloud.memsource.com/web/job2/list*
// @exclude      https://cloud.memsource.com/tms/transMemory/list*
// @exclude      https://cloud.memsource.com/tms/setup/*
// @exclude      https://cloud.memsource.com/web/setup/*
// @run-at       document-idle
// @grant        GM_setClipboard
// ==/UserScript==

(() => {
  /* ===================== Base / utils ===================== */
  const IS_TOP = window.top === window;
  const ORIGIN_ID = `${location.origin}${location.pathname}`;
  const THEME_KEY = 'ptv-theme'; // 'light' | 'dark'
  const $ = (s, r = document) => r.querySelector(s);

  let ui, showBtn, lastActive = null;
  let PTV_SELECTING = false;
  const PTV_RENDER_CACHE = { plain: '', html: '' };
    // Brief visual press feedback for buttons
function addClickFeedback(btn){
  if (!btn || btn.dataset._ptvClickFx) return;
  btn.dataset._ptvClickFx = '1';
  btn.addEventListener('click', () => {
    btn.classList.add('ptv-pressed');
    setTimeout(() => btn.classList.remove('ptv-pressed'), 150);
  }, true);
}


  /* ===================== UI ===================== */
  function ensureUI() {
    if (!IS_TOP) return;
    if ($('#hs-copybox')) { ui = $('#hs-copybox'); showBtn = $('#hs-showbtn'); return; }

    ui = document.createElement('div');
    ui.id = 'hs-copybox';
    ui.innerHTML = `
      <div class="hs-head">
        <strong>Phrase Tag Viewer</strong>
        <div class="hs-menu">
          <label class="hs-fontctrl" title="Preview font size (px)">
            <span class="hs-fs-label">A</span>
            <input id="hs-fs" type="number" min="10" max="48" step="1" value="14"/>
          </label>
          <label class="hs-theme-toggle" title="Toggle dark mode">
            <input id="hs-theme" type="checkbox"/><span>Dark</span>
          </label>
        </div>
      </div>
      <div id="hs-body">
        <div class="hs-textwrap">
          <div id="hs-pretty" aria-label="Converted preview" tabindex="0"></div>
          <textarea id="hs-out" aria-hidden="true"></textarea>
        </div>
        <div class="hs-buttons">
          <button id="hs-copybtn" title="Copy to clipboard">Copy</button>
          <button id="hs-hide" title="Hide panel">Hide</button>
        </div>
      </div>`;

    Object.assign(ui.style, {
      position:'fixed', left:'12px', bottom:'40px', width:'1420px', height:'110px', maxWidth:'98vw',
      zIndex:2147483647, borderRadius:'10px', boxShadow:'0 8px 24px rgba(0,0,0,.4)',
      font:'12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif', padding:'10px',
      display:'flex', flexDirection:'column'
    });

    const style = document.createElement('style');
    style.textContent = `
      /* Layout */
      #hs-copybox .hs-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;min-height:20px}
      #hs-copybox .hs-menu{display:flex;gap:10px;align-items:center}
      #hs-body{display:flex;gap:6px;flex:1;min-height:0}
      #hs-body .hs-textwrap{flex:1;display:flex;min-width:0}
      #hs-pretty{width:100%;height:100%;border-radius:8px;padding:6px;box-sizing:border-box;overflow:auto;white-space:pre-wrap;word-break:break-word;line-height:1.4;font-size:14px;
        font-family:"Inter","IBM Plex Sans","Segoe UI",system-ui,-apple-system,Roboto,Arial,sans-serif}
      #hs-out{display:none}
      #hs-copybox .hs-buttons{display:flex;flex-direction:column;gap:6px;align-items:stretch;justify-content:flex-start;min-width:110px}
      #hs-copybox button{border-radius:6px;cursor:pointer;font-size:12px;line-height:1;height:32px;padding:6px 10px;min-width:72px}
      /* Font size control */
      #hs-copybox .hs-fontctrl{display:flex;align-items:center;gap:4px;user-select:none}
      #hs-copybox .hs-fs-label{font-weight:700;opacity:.85;display:inline-block;width:14px;text-align:center;font-size:12px}
      #hs-copybox #hs-fs{width:56px;height:24px;border-radius:6px;padding:2px 6px;font-size:12px}
      /* Theme toggle */
      #hs-copybox .hs-theme-toggle{display:inline-flex;align-items:center;gap:6px;user-select:none;cursor:pointer;font-size:12px}
      #hs-copybox .hs-theme-toggle input{margin:0}
      /* Show button */
      #hs-showbtn{position:fixed;z-index:2147483647;border-radius:999px;padding:6px 10px;cursor:pointer;font:12px/1 system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;box-shadow:0 8px 24px rgba(0,0,0,.4)}
      #hs-showbtn.hidden{display:none!important}
      /* Theme: light (default) */
      #hs-copybox.ptv-light{background:#f7f8fa;color:#0b0f12;border:1px solid #cfd8e3}
      #hs-copybox.ptv-light #hs-pretty{background:#fff;color:#111827;border:1px solid #cfd8e3}
      #hs-copybox.ptv-light .hs-taglit{color:#1d4ed8;font-weight:600}
      #hs-copybox.ptv-light button{background:#eef2f7;color:#0b0f12;border:1px solid #cbd5e1}
      #hs-copybox.ptv-light button:hover{background:#e6edf7}
      #hs-copybox.ptv-light #hs-fs{background:#fff;color:#0b0f12;border:1px solid #cbd5e1}
      #hs-showbtn.ptv-light{background:#eef2f7;color:#0b0f12;border:1px solid #cbd5e1}
      #hs-showbtn.ptv-light:hover{background:#e6edf7}
      /* Theme: dark */
      #hs-copybox.ptv-dark{background:#0b0f12;color:#d7e2ea;border:1px solid #1f2a33}
      #hs-copybox.ptv-dark #hs-pretty{background:#0e1317;color:#e8f3ff;border:1px solid #1e2a33}
      #hs-copybox.ptv-dark .hs-taglit{color:#f6c560;font-weight:600}
      #hs-copybox.ptv-dark button{background:#10202a;color:#bfe8ff;border:1px solid #1e2f3a}
      #hs-copybox.ptv-dark button:hover{background:#143040}
      #hs-copybox.ptv-dark #hs-fs{background:#0e1317;color:#e8f3ff;border:1px solid #1e2a33}
      #hs-copybox.hidden{display:none!important}
      #hs-showbtn.ptv-dark{background:#10202a;color:#bfe8ff;border:1px solid #1e2f3a}
      #hs-showbtn.ptv-dark:hover{background:#143040}
      /* Selection: allow text dragging fully */
      #hs-pretty, #hs-pretty *{-webkit-user-select:text!important;-moz-user-select:text!important;user-select:text!important;pointer-events:auto!important}
      #hs-pretty{cursor:text}
      /* Smooth pressed feedback for buttons */
#hs-copybox button{
  transition: transform 120ms ease, filter 120ms ease, background-color 120ms ease;
}

/* When mouse is held down */
#hs-copybox button:active{
  transform: translateY(1px) scale(0.99);
  filter: brightness(0.96);
}

/* Brief pressed flash triggered by JS (for clicks that complete instantly) */
#hs-copybox button.ptv-pressed{
  transform: translateY(1px) scale(0.98);
  filter: brightness(0.92);
}
    `;
    document.documentElement.append(style, ui);

    // Bind once: selection guard to prevent mid-drag rerenders
    const prettyEl = $('#hs-pretty');
    if (prettyEl && !prettyEl.dataset._ptvBound) {
      prettyEl.dataset._ptvBound = '1';
      prettyEl.addEventListener('mousedown', () => { PTV_SELECTING = true; }, true);
      window.addEventListener('mouseup', () => { PTV_SELECTING = false; }, true);
    }

    // Persistent Show button
    showBtn = document.createElement('button');
    showBtn.id = 'hs-showbtn'; showBtn.textContent = 'Show'; showBtn.className = 'hidden';
    document.documentElement.appendChild(showBtn);

    // Theme
    const themeInput = $('#hs-theme');
    const applyTheme = t => {
      ui.classList.toggle('ptv-light', t==='light');
      ui.classList.toggle('ptv-dark', t==='dark');
      showBtn.classList.toggle('ptv-light', t==='light');
      showBtn.classList.toggle('ptv-dark', t==='dark');
      localStorage.setItem(THEME_KEY, t);
      themeInput.checked = (t === 'dark');
    };
    applyTheme(localStorage.getItem(THEME_KEY) || 'light');
    themeInput.addEventListener('change', () => applyTheme(themeInput.checked ? 'dark' : 'light'));

    // Copy
    $('#hs-copybtn').addEventListener('click', async () => {
      const text = $('#hs-out')?.value || '';
      try {
        if (typeof GM_setClipboard === 'function') return GM_setClipboard(text, { type:'text', mimetype:'text/plain' });
        await navigator.clipboard.writeText(text);
      } catch {
        const ta = $('#hs-out'); if (ta) { ta.focus(); ta.select(); document.execCommand('copy'); }
      }
        addClickFeedback($('#hs-copybtn'));
    });

    // Font size controller
    const fsInput = $('#hs-fs'), applyFs = () => {
      const px = Math.max(10, Math.min(48, Number(fsInput.value || 14) || 14));
      const pretty = $('#hs-pretty'); if (pretty) pretty.style.fontSize = px + 'px';
    };
    fsInput.addEventListener('input', applyFs);
    fsInput.addEventListener('change', applyFs);
    applyFs();

    // Show button near panel's right edge
    const positionShowButtonNearHide = () => {
      if (!ui || !showBtn) return;
      const r = ui.getBoundingClientRect();
      showBtn.style.left = Math.round(r.left + r.width - 88) + 'px';
      showBtn.style.bottom = Math.max(8, Math.round(window.innerHeight - r.bottom)) + 'px';
    };

    // Hide/Show
    $('#hs-hide').addEventListener('click', () => { positionShowButtonNearHide(); ui.classList.add('hidden'); showBtn.classList.remove('hidden'); });
    showBtn.addEventListener('click', () => { ui.classList.remove('hidden'); showBtn.classList.add('hidden'); });
    window.addEventListener('resize', () => { if (ui.classList.contains('hidden')) positionShowButtonNearHide(); });
    window.addEventListener('keydown', e => { if (e.altKey && (e.key==='p'||e.key==='P')) ui.classList.contains('hidden') ? showBtn.click() : $('#hs-hide').click(); }, true);
  }

  const setPreview = (plain, html) => {
    const pretty = $('#hs-pretty'), ta = $('#hs-out');
    if (!pretty || !ta) return;
    if (PTV_RENDER_CACHE.plain === (plain||'') && PTV_RENDER_CACHE.html === (html||'')) return; // no-op
    PTV_RENDER_CACHE.plain = plain || ''; PTV_RENDER_CACHE.html = html || '';
    pretty.innerHTML = PTV_RENDER_CACHE.html; ta.value = PTV_RENDER_CACHE.plain;
      addClickFeedback($('#hs-hide'));
  };

  /* ===================== Decoding / conversion ===================== */
  const decodeHtml = s => { const t = document.createElement('textarea'); t.innerHTML = s; return t.value; };
  const escapeHtml = s => String(s ?? '').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
  const stripNumericBraces = s => String(s ?? '').replace(/\{(\d+)\}/g, '$1'); // "{123}" → "123"

  function extractPhraseTagValue(el) {
    const meta = el.querySelector?.('.tag_metadata_content')?.textContent || el.getAttribute?.('tmp-title') || el.getAttribute?.('title') || '';
    if (!meta) return { text:'', fromTag:true };
    const un = decodeHtml(meta);
    // mq:rxt
    let m = un.match(/displaytext="([^"]*)"/i) || un.match(/val="([^"]*)"/i);
    if (m) return { text: decodeHtml(m[1]||''), fromTag:true };
    // bpt/ept
    let inner = un.match(/<(?:bpt|ept)\b[^>]*>([\s\S]*?)<\/(?:bpt|ept)>/i) || un.match(/<\w+\b[^>]*>([\s\S]*?)<\/\w+>/i);
    if (inner) return { text: decodeHtml(inner[1]||''), fromTag:true };
    // placeholder fallback
    return { text: el.getAttribute?.('data-tag-content') || '', fromTag:true };
  }

  function rebuildConvertedRich(container) {
    if (!container) return { plain:'', html:'' };
    let plain = '', html = '';
    container.childNodes.forEach(n => {
      if (n.nodeType === 3) { const t = n.nodeValue || ''; plain += t; html += escapeHtml(t); return; }
      if (n.nodeType !== 1) return;
      const el = n;
      if (el.classList?.contains('te_txt')) {
        const t = el.textContent || ''; plain += t; html += escapeHtml(t); return;
      }
      if (el.classList?.contains('te_tag') || el.matches?.('[data-testid="tag"],[data-tag],[data-tag-type]')) {
        const { text } = extractPhraseTagValue(el);
        const m = /^\{(\d+)\}$/.exec(text);
        if (m) { const num = m[1]; plain += num; html += `<span class="hs-taglit">${escapeHtml(num)}</span>`; }
        else { plain += text; html += `<span class="hs-taglit">${escapeHtml(text)}</span>`; }
      }
    });
    return { plain: stripNumericBraces(plain), html };
  }

  /* ===================== Active row ===================== */
  const finders = {
    byCaret: d => d.getElementById?.('segment-text-editor-input')?.closest?.('.twe_segment') || null,
    byCursor: d => d.querySelector?.('.twe_segment .twe_target .te_selection_container .te_cursor')?.closest?.('.twe_segment') || null,
    byFocusedInput(d) {
      const a = d.activeElement; if (!a) return null;
      return a.matches?.('input.twe-main-input, textarea.twe-main-input, [contenteditable="true"]')
        ? (a.closest('.twe_segment') || a.closest('[data-testid="segment"]') || null) : null;
    },
    byActiveClass: d => d.querySelector?.('.twe_segment.twe_active, .twe_segment.twe_active_background, [data-testid="segment"][data-selected="true"]')
  };

  function readActiveFromDoc(doc) {
    const row = finders.byCaret(doc) || finders.byCursor(doc) || finders.byFocusedInput(doc) || finders.byActiveClass(doc);
    if (!row) return { row:null, plain:'', html:'' };
    const cont = row.querySelector?.('.twe_target .te_text_container') ||
                 row.querySelector?.('[data-testid="target"] .te_text_container') ||
                 row.querySelector?.('.twe_target [data-role="text-container"]');
    if (cont) return { row, ...rebuildConvertedRich(cont) };
    const live = row.querySelector?.('.twe_target .twe-main-input, textarea.twe-main-input, [contenteditable="true"]');
    const raw = (live && (live.value || live.textContent)) || '';
    return { row, plain: stripNumericBraces(raw), html: escapeHtml(raw) };
  }

  /* ===================== Iframes (same-origin sweep) ===================== */
  function getAllDocs(rootDoc = document, acc = new Set()) {
    if (!rootDoc || acc.has(rootDoc)) return { docs: Array.from(acc), totalFrames:0, okFrames:0 };
    acc.add(rootDoc);
    const ifr = rootDoc.querySelectorAll('iframe'); let total=0, ok=0;
    for (const f of ifr) {
      total++;
      try {
        const d = f.contentDocument || f.contentWindow?.document;
        if (d) { ok++; const nested = getAllDocs(d, acc); total += nested.totalFrames; ok += nested.okFrames; }
      } catch {}
    }
    return { docs: Array.from(acc), totalFrames:total, okFrames:ok };
  }

  /* ===================== Bridge ===================== */
  const MSG_MARK = '__hs_bridge__';
  const postToChildren = msg => { if (!IS_TOP) return; for (let i=0;i<window.frames.length;i++) { try { window.frames[i].postMessage({[MSG_MARK]:true, ...msg}, '*'); } catch {} } };
  const postToParent = msg => { if (IS_TOP) return; try { window.parent.postMessage({[MSG_MARK]:true, ...msg}, '*'); } catch {} };

  window.addEventListener('message', e => {
    const d = e?.data; if (!d || !d[MSG_MARK]) return;
    if (IS_TOP) {
      if (d.type === 'ACTIVE') {
        lastActive = { plain: (d.payload?.plain ?? d.payload?.text) || '', html: d.payload?.html || '' };
        ensureUI(); render();
      }
    } else {
      if (d.type === 'PING') postToParent({ type:'PONG', frameId:ORIGIN_ID, info:'editor-frame' });
      if (d.type === 'REQUEST_ACTIVE') {
        const r = readActiveFromDoc(document);
        postToParent({ type:'ACTIVE', frameId:ORIGIN_ID, info:'editor-frame', payload:{ plain:r.plain||'', html:r.html||'' } });
      }
    }
  }, true);

  /* ===================== Render/update ===================== */
  function render() {
    if (!IS_TOP || PTV_SELECTING) return;
    ensureUI();
    // same-origin first
    const { docs } = getAllDocs(document);
    let found = null;
    for (const d of docs) { const r = readActiveFromDoc(d); if (r.row) { found = r; break; } }
    const active = found || lastActive || null;
    setPreview(active?.plain || '', active?.html || '');
  }

  function wireInstantSignals() {
    const instant = () => { IS_TOP ? render() : tickFrame(); };
    ['input','keyup','selectionchange','pointerup','focusin'].forEach(ev => document.addEventListener(ev, instant, true));
  }

  function tickTop() { postToChildren({type:'PING'}); postToChildren({type:'REQUEST_ACTIVE'}); render(); }
  function tickFrame() {
    const r = readActiveFromDoc(document);
    if (r && (r.row || r.plain || r.html)) postToParent({ type:'ACTIVE', frameId:ORIGIN_ID, info:'editor-frame', payload:{ plain:r.plain||'', html:r.html||'' } });
    else postToParent({ type:'PONG', frameId:ORIGIN_ID, info:'probe' });
  }

  /* ===================== Boot ===================== */
  function boot() {
    if (IS_TOP) ensureUI();
    wireInstantSignals();
    const tick = IS_TOP ? tickTop : tickFrame;
    setTimeout(tick, 300);
    setInterval(tick, 350);
  }
  boot();
})();
      </script>
    </div>

    <div class="card">
      <h2>4) Open Phrase and try it</h2>
      <ul>
        <li>Open a job in <b>app.phrase.com</b> (or your Memsource domain).</li>
        <li>Select a <b>target segment</b>.</li>
        <li>Look for the “<b>Phrase Tag Viewer</b>” panel at the bottom-left of the page.</li>
        <li>Use <b>Copy</b> to copy the plain converted string, or toggle Dark mode / font size from the menu.</li>
      </ul>
      <p class="ok">If you see text appearing in the panel as you click segments, you’re all set!</p>
    </div>

    <div class="card">
      <h2>Troubleshooting</h2>
      <ul>
        <li>Make sure the userscript is <b>Enabled</b> in Tampermonkey’s Dashboard.</li>
        <li>Ensure the tab URL matches the script’s <code>@match</code> lines (e.g., <code>https://app.phrase.com/…</code>).</li>
        <li>Open the browser console (F12 → Console) and check for red error messages.</li>
        <li>If your team uses multiple Phrase domains, add extra <code>@match</code> lines as needed.</li>
      </ul>
    </div>
  </div>

  <script>
    (function(){
      const payloadTag = document.getElementById('payload');   // <script type="text/plain">
      const codeblock  = document.getElementById('codeblock'); // <code> preview
      const btn        = document.getElementById('copyCodeBtn');

      // Read the userscript as raw text (safe; not parsed/executed)
      const userscript = (payloadTag && payloadTag.textContent) ? payloadTag.textContent.trim() : '';

      // Show in the visible code box (use textContent for safety)
      codeblock.textContent = userscript || '(no script pasted yet)';

      btn.addEventListener('click', async () => {
        const text = userscript || '';
        if (!text) { btn.textContent = 'Nothing to copy'; setTimeout(()=>btn.textContent='Copy code', 1300); return; }
        try {
          await navigator.clipboard.writeText(text);
          btn.textContent = 'Copied!';
          setTimeout(() => btn.textContent = 'Copy code', 1400);
        } catch (e) {
          // Fallback
          const ta = document.createElement('textarea');
          ta.value = text; ta.style.position = 'fixed'; ta.style.left='-9999px'; ta.style.top='-9999px';
          document.body.appendChild(ta); ta.focus(); ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          btn.textContent = ok ? 'Copied!' : 'Select & Ctrl+C';
          setTimeout(() => btn.textContent = 'Copy code', 1400);
        }
      });
    })();
  </script>
</body>
</html>
